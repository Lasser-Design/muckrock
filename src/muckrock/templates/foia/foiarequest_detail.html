
{% extends "foia/base.html" %}
{% load pingback_tags %}

{% block content %}
	<h1>FOI Request</h1>
	<h2>{{object.title}}</h2>
	<p>Requested by <a href="{% url acct-profile object.user.username %}">{{object.user.username}}</a>
	{% if object.date_submitted %} on {{object.date_submitted|date}}{%endif%}
	for the {{object.agency}} of {{object.jurisdiction}}
	{% if object.date_done %} and fufilled on {{object.date_done|date}}{%endif%}
	</p>
	<div id="progressbar" title="{{object.percent_complete}}% Complete"></div>
	<p>Status: <span class="request-{{object.color_code}}">
		{{object.get_status_display}}{% if object.date_due and object.status == "processed" %},
		{% if past_due %}
			past due by {{ object.date_due|timesince }}
		{% else %}
			due in {{ object.date_due|timeuntil }}
		{% endif %}
		</span>
	{%endif%}

	{% if object.doc_first_page %}
	- <a href="{{object.doc_first_page.get_absolute_url}}">View Official Response</a>
	{% endif %}
	{% if object.public_documents %}
	<h4>Documents:</h4>
	<ul>
		{% for document in object.public_documents %}
			<li><a href="{{document.get_absolute_url}}">{{document.title}}</a></li>
		{% endfor %}
	</ul>
	{% endif %}
	{% if object.files.all %}
	<h4>Attached Files:</h4>
	<ul>
		{% for file in object.files.all %}
		<li><a href="/static/{{file.ffile.name}}">{{file.name}}</a></li>
		{% endfor %}
	</ul>
	{% endif %}
	</p>
	{% if object.is_embargo and not object.date_done %}
	<p>
	This request is embargoed and will not be visible to others until 30 days after a response is received.
	</p>
	{% endif %}
	{% if object.is_embargo and object.date_done %}
	<p>
	This request is embargoed and will not be visible until {{ object.embargo_date }}.
	</p>
	{% endif %}

	{% for comm in object.communications.all %}
	<div class="{% if comm.response %}response{% else %}request{% endif %}">
		<strong>From {{comm.from_who}} on {{comm.date|date}}:</strong><br />
		{% if comm.full_html %}
			{% autoescape off %}{{comm.communication}}{% endautoescape %}
		{% else %}
			{{comm.communication|urlize|linebreaks}}
		{% endif %}
	</div>
	{% endfor %}

{% endblock %}

{% block sidebar %}
	{% if user == object.user and object.is_editable %}
		<h2>Actions</h2>
		<ul>
			<li><a href="{% url foia-update jurisdiction=object.jurisdiction.slug,idx=object.id,slug=object.slug %}">Update</a></li>
		{% if object.is_deletable %}
			<li><a href="{% url foia-delete jurisdiction=object.jurisdiction.slug,idx=object.id,slug=object.slug %}">Delete</a></li>
		{% endif %}
		</ul>
		<div class="content-separator"></div>
	{% endif %}

	{% get_pingback_list for object as pingbacks %}
	{% if pingbacks %}
	    <h2>Pingbacks:</h2>
	    {% for pingback in pingbacks %}
	        <div class="b-pingback">
						<strong>{{ pingback.url|urlizetrunc:40 }}</strong><br />
						<em>{{ pingback.date|date }}</em><br />
	
						<p>{{ pingback.content }}</p>
	        </div>
	    {% endfor %}
		<div class="content-separator"></div>
	{% endif %}

{% endblock %}
