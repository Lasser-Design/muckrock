{% extends 'foiamachine/base.html' %}

{% block main %}
<main>
    <h1>Create a public records request</h1>
    <form method="post" class="form">
        {% csrf_token %}
        {% include 'lib/pattern/form.html' %}
        <button type="submit" class="button">Create request</button>
    </form>
</main>
{% endblock %}

{% block scripts %}
{{block.super}}
<script type="text/javascript">
/*
This script modifies the behavior of the Jurisdiction and Agency autocomplete inputs.
When there is no jurisdiction selected, we want to disable the agency input.
When there is a jurisdiction selected, we want to enable the agency input and only allow
autocomplete results to come from the selected jurisdiction.
When the jurisdiction selection is removed, we want to clear and disable the agency input.
*/

// Functions for modifying the agency input

function disableAgencyAutocomplete(disabled) {
    $('#id_agency-autocomplete').attr('disabled', disabled);
    $('#id_agency').attr('disabled', disabled);
    var agencyField = $('#id_agency').closest('.field');
    if (disabled) {
        agencyField.addClass('disabled');
    } else {
        agencyField.removeClass('disabled');
    }
}
function updateAgencyAutocompleteJurisdiction(id) {
    $('#id_agency-autocomplete').yourlabsAutocomplete().data = {
        jurisdiction_id: id
    }
}
function clearAgencyAutocomplete() {
    var widget = $('#id_agency-wrapper').yourlabsWidget()
    widget.freeDeck();
}

// Functions for responding to changes on the jurisdiction input

function jurisdictionChange(e) {
    var jurisdiction = $(e.target).val();
    console.log(jurisdiction);
    if (jurisdiction) {
        disableAgencyAutocomplete(false);
        updateAgencyAutocompleteJurisdiction(jurisdiction);
    } else {
        clearAgencyAutocomplete();
        disableAgencyAutocomplete(true);
    }
}

$('#id_jurisdiction').change(jurisdictionChange);

disableAgencyAutocomplete(true);

</script>
{% endblock %}
