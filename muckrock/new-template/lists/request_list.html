{% extends 'lists/base_list.html' %}
{% load tags %}

{% block title %}MuckRock &bull; Requests{% endblock title %}
{% block list-title %}<h1>{{ title }}</h1>{% endblock list-title %}
{% block list-subtitle %}<h2>{{ subtitle }}</h2>{% endblock list-subtitle %}
{% block type %}request{% endblock type %}

{% block list %}
<ul class="list heading">
    <li class="foia-info"><dfn>Title</dfn></li>
    <li class="foia-info"><dfn>Date</dfn></li>
</ul>
<ul class="list">
    {% for item in object_list %}
    <li>
        {% with item as foia %}
        <div class="foia-info">
            <h3 class="{{ foia.color_code }}" id="request-status">{{foia.get_status_display}}</h3>
            <h2><a href="{{ foia.get_absolute_url }}">{{ foia.title }}</a></h2>
        </div>
        
        <dl class="foia-info">
            <dt>First Submitted</dt>
            <dd>{{ foia.communications.all.0.date|date:"m/d/Y" }}</dd>
            <dt>Last Updated</dt>
            <dd>{{ foia.last_comm_date|date:"m/d/Y" }}</dd>
        </dl>
        <dl class="foia-info">
            <dt>From</dt>
            <dd><a href="{% url 'acct-profile' foia.user.username %}">{{ foia.user.get_full_name }}</a></dd>
            {% if foia.agency %}
            <dt>To</dt>
            <dd><a href="{{ foia.agency.get_absolute_url }}">{{ foia.agency.name }}</a> of {% if foia.jurisdiction.name = 'United States of America' %}the {% endif %}<a href="{{ foia.jurisdiction.get_absolute_url }}">{{ foia.jurisdiction.name }}</a></dd>
            {% endif %}
        </dl>
        {% endwith %}
    </li>
    {% empty %}
    <li class="empty">Hmm&hellip; looks like there&rsquo;s nothing here.</li>
    {% endfor %}
</ul>
{% endblock list %}

{% block actions %}
{% endblock actions %}

{% block filters %}
{% if user.is_authenticated %}
<ul>
    <li><a href="{% url 'foia-list' %}" class="{% active request "^/foi/list/$" %}">All</a></li>
    <li><a href="{% url 'foia-mylist-all' %}" class="{% active request "^/foi/mylist/$" %}">Mine</a></li>
    <li><a href="{% url 'foia-list-following' %}" class="{% active request "^/foi/list/following/$" %}">Following</a></li>
</ul>
{% endif %}
<form action="" method="post" name="request-filters">
    {% csrf_token %}
    {% for field in form %}
        <div class="input">
            {{ field }}
        </div>
    {% endfor %}
    <div class="input">
        <input type="submit" value="Filter" class="button" />
    </div>
</form>
{% endblock filters %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $("#id_status").append('<option disabled selected id="title-value">Status</option>');
    });
</script>
{% endblock scripts %}