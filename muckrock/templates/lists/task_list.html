{% extends 'lists/base_list.html' %}

{% block title %}MuckRock &bull; Tasks{% endblock title %}
{% block list-title %}<h1>Tasks</h1>{% endblock list-title %}
{% block type %}task{% endblock type %}

{% block list %}

{% for task in tasks %}

		{% if task.orphantask %}
			<section class="received message">
				<h1>Orphan</h1>
				<h2>{{task.orphantask.get_reason_display}} on {{task.date_created|date}}</h2>
				<span>Sent to {{task.orphantask.address}}</span><br />
				{% if task.orphantask.communication.likely_foia %}
				<span><a href="http://www.muckrock.com{% url 'admin:foia_foiarequest_change' task.orphantask.communication.likely_foia.pk %}">Probable Request</a></span><br />
					<span><a href="#" class="button">Move to Probable Request</a></span>
				{% endif %}
				<span><a href="#" class="button">Delete</a></span>
				<p>{{task.orphantask.communication.communication}}</p>
			</section>

		{% elif task.snailmailtask %}
			{% with task.snailmailtask.communication.foia as foia %}
			<section class="received message">
				<h1>Snail Mail</h1>
				<h2>{{task.snailmailtask.get_category_display}} on {{task.date_created|date}}</h2>
				<span>Acknowledged? {{foia.has_ack}}</span><br />
				<span>Set status:
					<a href="#" class="button">Awaiting Acknowledgement</a>
					<a href="#" class="button">Awaiting Response</a>
					<a href="#" class="button">Awaiting Appeal</a>
				</span><br />
				<span><a href="http://www.muckrock.com{% url 'admin:auth_user_change' foia.user.pk %}">Submitter: {{foia.user}}</a></span> | 
				<span><a href="http://www.muckrock.com{% url 'admin:foia_foiarequest_change' foia.pk %}">FOIA: {{foia}}</a></span>
				{# agency info #}
				<p>{{task.snailmailtask.communication.communication}}</p>
			</section>
			{% endwith %}

		{% elif task.rejectedemailtask %}
			<section class="received message">
				<h1>Rejected Email</h1>
				<h2>{{task.rejectedemailtask.get_category_display}} on {{task.date_created|date}}</h2>
				{% if task.rejectedemailtask.foia %}
				<span><a href="http://www.muckrock.com{% url 'admin:foia_foiarequest_change' task.rejectedemailtask.foia.pk %}">FOIA: {{task.rejectedemailtask.foia}} </a></span><br />
				{% endif %}
				<span>From: {{task.rejectedemailtask.email}}</span><br />
				<span>Error: {{task.rejectedemailtask.error}}</span><br />
				{# XXX put other agencies and foias here #}
			</section>

		{% elif task.staleagencytask %}
			<section class="received message">
				<h1>Stale Agency</h1>
				<h2>{{task.date_created|date}}</h2>
				<span><a href="http://www.muckrock.com{% url 'admin:agency_agency_change' task.staleagencytask.agency.pk %}">Agency: {{task.staleagencytask.agency}}</a></span><br />
			</section>

		{% elif task.flaggedtask %}
			<section class="received message">
				<h1>Flagged</h1>
				<h2>{{task.date_created|date}}</h2>
				<span><a href="#" class="button">Resolve</a></span><br />
				<span><a href="http://www.muckrock.com{% url 'admin:auth_user_change' task.flaggedtask.user.pk %}">User: {{task.flaggedtask.user}}</a></span> |
				{% if task.flaggedtask.foia %}
				<span><a href="http://www.muckrock.com{% url 'admin:foia_foiarequest_change' task.flaggedtask.foia.pk %}">FOIA: {{task.flaggedtask.foia}} </a></span><br />
				{% elif task.flaggedtask.agency %}
				<span><a href="http://www.muckrock.com{% url 'admin:agency_agency_change' task.flaggedtask.agency.pk %}">Agency: {{task.flaggedtask.agency}}</a></span><br />
				{% elif task.flaggedtask.jurisdiction %}
				<span><a href="http://www.muckrock.com{% url 'admin:jurisdiction_jurisdiction_change' task.flaggedtask.jurisdiction.pk %}">Jurisdiction: {{task.flaggedtask.jurisidiction}}</a></span><br />
				{% endif %}
				<p>{{task.flaggedtask.text}}</p>
			</section>

		{% elif task.newagencytask %}
			<section class="received message">
				<h1>New Agency</h1>
				<h2>{{task.date_created|date}}</h2>
				<span><a href="#" class="button">Approve</a></span>
				<span><a href="#" class="button">Reject</a></span>
				<br \>
				<span><a href="http://www.muckrock.com{% url 'admin:agency_agency_change' task.newagencytask.agency.pk %}">Agency: {{task.newagencytask.agency}}</a></span>
				{% if task.newagency.user %} | <span><a href="http://www.muckrock.com{% url 'admin:auth_user_change' task.newagencytask.user.pk %}">User: {{task.newagencytask.user}}</a></span>{% endif %}
			</section>

		{% elif task.responsetask %}
			<section class="received message">
				<h1>Response</h1>
				<h2>{{task.date_created|date}}</h2>
				{% with task.responsetask.communication as comm %}
				<span>Response reseived from {{comm.priv_from_who}} for request {{comm.foia.title}} - {{comm.foia.mail_id}}</span><br />
				<span>Set status: <em>select status here</em></span><br />
				<span><a href="http://www.muckrock.com{% url 'admin:foia_foiarequest_change' comm.foia.pk %}">FOIA: {{comm.foia}}</a></span><br />
				<p>{{comm.communication}}</p>
			</section>

		{% else %}
			<section class="received message">
				<h1>Bare task... something went wrong!</h1>
				{{ task }}
			</section>
		{% endif %}
{% endfor %}

{% endblock list %}
