{% extends 'lists/base_list.html' %}

{% load tasks %}

{% block title %}MuckRock &bull; Tasks{% endblock title %}
{% block type %}task{% endblock type %}

{% block filters %}
<ul>
	<li><a href="{% url 'task-list' %}">All</a></li>
	{% for user in staff_users %}
	<li><a href="?user={{user.username}}">{{user.username}}</a></li>
	{% endfor %}
</ul>
{% endblock %}

{% block list-content %}

{% for task in object_list %}
		{% if task.orphantask %}
			{% orphan task %}
		{% elif task.snailmailtask %}
			{% snail_mail task %}
		{% elif task.rejectedemailtask %}
			{% rejected_email task %}
		{% elif task.staleagencytask %}
			{% stale_agency task %}
		{% elif task.flaggedtask %}
			{% flagged task %}
		{% elif task.newagencytask %}
			{% new_agency task %}
		{% elif task.responsetask %}
			{% response task %}
		{% else %}
			<section class="received message">
				<h1>Bare task... something went wrong!</h1>
				{{ task }}
			</section>
		{% endif %}
{% endfor %}

{% endblock list-content %}

{% block list-scripts %}
var csrftoken = $.cookie('csrftoken');
function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});
{% endblock list-scripts %}
