{% load thumbnail %}

<header class="global-header">
    <nav class="space-between mb0" id="nav">
        <div class="align-center mb0">
            <a href="{% url 'index'%}" class="nav-item brand">
                <span class="logotype">
                    {% include 'lib/component/icon/logotype.svg' %}
                </span>
                <span class="logo">
                    {% include 'lib/component/icon/logo.svg' %}
                </span>
            </a>
            <ul>
                <li>
                    <a class="nav-item" href="{% url 'news-index' %}">News</a>
                    <ul>
                        <li><a class="nav-item" href="{% url 'news-archive' %}">Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a class="nav-item" href="{% url 'project' %}">Projects</a>
                    <ul>
                        {% if user.is_authenticated %}
                        <li><a class="nav-item" href="{% url 'project-contributor' username=user.username %}">Yours</a></li>
                        {% endif %}
                        <li><a class="nav-item" href="{% url 'project-list' %}">Archive</a></li>
                    </ul>
                </li>
                <li>
                    <a class="nav-item" href="{% url 'foia-root' %}">Requests</a>
                    <ul>
                        <li><a class="nav-item" href="{% url 'foia-list' %}">All</a></li>
                        {% if user.is_authenticated %}
                        <li><a class="nav-item" class="nav-item" href="{% url 'foia-mylist' %}">Yours</a></li>
                            {% if user.profile.is_advanced %}
                        <li><a class="nav-item" href="{% url 'foia-mymulti' %}">Multirequests</a></li>
                            {% endif %}
                            {% if user.is_staff %}
                        <li><a class="nav-item" href="{% url 'foia-list-processing' %}">Processing</a></li>
                            {% endif %}
                        {% endif %}
                    </ul>
                </li>
                {% if user.is_staff %}
                <li>
                    <a class="nav-item" href="{% url 'task-list' %}">Tasks</a>
                    <ul>
                        <li><a class="nav-item" href="{% url 'response-task-list' %}">Response</a></li>
                        <li class="separator"><a class="nav-item" href="{% url 'foia-list-processing' %}">Processing</a></li>
                        <li><a class="nav-item" href="{% url 'new-agency-task-list' %}">New Agency</a></li>
                        <li><a class="nav-item" href="{% url 'orphan-task-list' %}">Orphan</a></li>
                        <li><a class="nav-item" href="{% url 'snail-mail-task-list' %}">Snail Mail</a></li>
                        <li><a class="nav-item" href="{% url 'flagged-task-list' %}">Flagged</a></li>
                        <li class="separator"><a class="nav-item" href="{% url 'newexemption-task-list' %}">New Exemptions</a></li>
                        <li><a class="nav-item" href="{% url 'stale-agency-task-list' %}">Stale Agency</a></li>
                        <li><a class="nav-item" href="{% url 'rejected-email-task-list' %}">Rejected Email</a></li>
                        <li class="separator"><a class="nav-item" href="{% url 'failed-fax-task-list' %}">Failed Fax</a></li>
                        <li><a class="nav-item" href="{% url 'multirequest-task-list' %}">Multirequest</a></li>
                        <li><a class="nav-item" href="{% url 'projectreview-task-list' %}">Pending Projects</a></li>
                        <li><a class="nav-item" href="{% url 'crowdfund-task-list' %}">Crowdfund</a></li>
                        <li><a class="nav-item" href="{% url 'status-change-task-list' %}">Status Change</a></li>
                    </ul>
                </li>
                {% endif %}
                <li id="more-sections">
                    <span class="nav-item">{% include 'lib/component/icon/sections-dots.svg' %}</span>
                    <ul>
                        <li><a class="nav-item" href="{% url 'jurisdiction-list' %}">Jurisdictions</a></li>
                        <li><a class="nav-item" href="{% url 'agency-list' %}">Agencies</a></li>
                        <li class="separator"><a class="nav-item" href="{% url 'question-index' %}">Q&amp;A Forum</a></li>
                        <li class="separator"><a class="nav-item" href="{% url 'donate' %}">Donate</a></li>
                        <li><a class="nav-item" href="/about/">About Us</a></li>
                        <li><a class="nav-item" href="/staff/">Staff</a></li>
                        <li><a class="nav-item" href="/faq/">FAQ</a></li>
                        <li><a class="nav-item" href="/api/">API</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <!-- We have to keep the search form in the middle, otherwise Firefox will mess up the flexbox justification -->
        <form action="/search" method="get" class="search-form" id="global-search">
            <div class="search-form-container">
                <input type="search" name="q" placeholder="Search">
                <input type="submit" style="display: none;">
                <div class="search-cancel" id="hide-search">Cancel</div>
            </div>
        </form>
        <div>
            <ul>
                <li>
                    <span class="nav-item search-button" id="show-search">
                        {% include 'lib/component/icon/search.svg' %}
                        <span class="label">Search</span>
                    </span>
                </li>
                <li>
                    <a class="blue nav-item" href="{% url 'foia-create'%}" onclick="ga('send', 'event', 'Requests', 'File', window.location.pathname)">
                {% include 'lib/component/icon/create-request.svg' %}
                <span class="label">File<span class="extended"> Request</span></span>
                    </a>
                </li>
            {% if user.is_authenticated %}
                <li class="dropdown--right">
                    <a href="{% url 'acct-my-profile' %}" class="black nav-item align-center avatar-container">
                        <img class="round avatar mb0" src="{% thumbnail user.profile.avatar 31x31 %}">
                        <span class="label">{{ user.get_full_name }}
                    </a>
                    <ul>
                        {% if payment_failed %}
                        <li class="error message small">
                            <span class="symbol">
                                {% include 'lib/component/icon/error.svg' %}
                            </span>
                            <span class="text">
                                <p>Your payment failed! A recent charge made against your credit card has failed.</p>
                                <a class="basic red button" href="{% url 'acct-settings' %}#billing">Update your billing info</a>
                            </span>
                        </li>
                        {% endif %}
                        {% if broadcast %}
                        <li class="broadcast">
                            <dfn>Announcement</dfn>
                            <p>{{ broadcast|safe }}</p>
                        </li>
                        {% endif %}
                        {% if organization %}
                        <li><a class="nav-item" href="{{organization.get_absolute_url}}">Your&nbsp;Organization</a></li>
                        {% endif %}
                        {% if my_projects %}
                        <li><a class="nav-item" href="{% url 'project-contributor' username=request.user.username %}">Your&nbsp;Projects</a></li>
                        {% endif %}
                        <li><a class="nav-item" href="{% url 'foia-mylist' %}">Your&nbsp;Requests</a></li>
                        {% if actionable_requests %}
                        {% if actionable_requests.payment %}
                        <li>
                            <a class="nav-item" href="{% url 'foia-mylist' %}?status=payment"><span class="red counter">{{ actionable_requests.payment|length }}</span>&nbsp;Payment{{ actionable_requests.payment|length|pluralize }}&nbsp;Required</a>
                        </li>
                        {% endif %}
                        {% if actionable_requests.fix %}
                        <li>
                            <a class="nav-item" href="{% url 'foia-mylist' %}?status=fix"><span class="red counter">{{ actionable_requests.fix|length }}</span>&nbsp;Fix{{ actionable_requests.fix|length|pluralize:"es" }}&nbsp;Required</a>
                        </li>
                        {% endif %}
                        {% if actionable_requests.started %}
                        <li>
                            <a class="nav-item drafts" href="{% url 'foia-mylist' %}?status=started">
                                <span class="blue counter">{{ actionable_requests.started|length }}</span>
                                &nbsp;Draft{{ actionable_requests.started|length|pluralize }}
                            </a>
                        </li>
                        {% endif %}
                        {% endif %}
                    </ul>
                </li>
                <li>
                    {% if unread_notifications.count > 0 %}
                    <a href="{% url 'acct-notifications-unread' %}" class="black unread nav-item">
                        <span class="blue counter">{{unread_notifications.count}}</span>
                    {% else %}
                    <a href="{% url 'acct-notifications' %}" class="black nav-item">
                    {% endif %}
                        {% include 'lib/component/icon/notification.svg' %}
                    </a>
                </li>
                <li class="dropdown--right">
                    <span class="black nav-item">{% include 'lib/component/icon/options.svg' %}</span>
                    <ul>
                        {% if user.is_staff %}
                        <li>
                            <a class="nav-item" href="{% if sidebar_admin_url %}{{ sidebar_admin_url }}{% else %}/admin/{% endif %}">Admin</a>
                        </li>
                        {% endif %}
                        <li>
                            <a class="nav-item" href="{% url 'acct-settings' %}">Settings</a>
                        </li>
                        <li>
                            <a class="nav-item" href="{% url 'acct-logout' %}" onclick="ga('send', 'event', 'Account', 'Logout', window.location.pathname)">Log&nbsp;Out</a>
                        </li>
                    </ul>
                </li>
            {% else %}
                <li><a href="{% url 'accounts' %}" class="sign-up nav-item">Sign&nbsp;Up</a></li>
                <li>
                    <a href="{% url 'acct-login' %}?next={{ request.get_full_path }}" class="log-in nav-item" id="quick-log-in">Log&nbsp;In</a>
                    <ul>
                    </ul>
                </li>
            {% endif %}
            </ul>
        </div>
    </nav>
</header>
