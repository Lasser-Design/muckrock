{% extends 'base.html' %}
{% load thumbnail %}
{% load markdown_deux_tags %}
{% load static from staticfiles %}

{% block content %}
<div class="project frontpage">
    <header>
        <h1>Projects <span class="primary badge">BETA</span></h1>
    </header>
    <div class="discover">
        {% for project in featured %}
        <div class="project">
            <header class="no-bottom-margin">
                <a href="{{project.get_absolute_url}}"><img class="image" src="{% thumbnail project.image 800x200 crop %}" /></a>
            </header>
            <div class="details no-bottom-margin">
                <h3 class="title"><a href="{{project.get_absolute_url}}">{{project.title}}</a></h3>
                <div class="summary">
                    {{project.summary|markdown}}
                </div>
            </div>
            <div class="overview">
                {% if project.requests.exists %}
                <p><a href="{{project.get_absolute_url}}#requests"><span class="counter">{{project.requests.count}}</span> Request{{project.requests.count|pluralize}}</a></p>
                {% endif %}
                {% if project.articles.exists %}
                <p><a href="{{project.get_absolute_url}}#articles"><span class="counter">{{project.articles.count}}</span> Article{{project.articles.count|pluralize}}</a></p>
                {% endif %}
                <div class="contributors">
                    <dfn>Contributor{{project.contributors.count|pluralize}}</dfn>
                    <ul class="nostyle">
                    {% for contributor in project.contributors.all %}
                        <li>
                            <a class="contributor" href="{{contributor.profile.get_absolute_url}}">
                                {% if contributor.profile.avatar %}
                                <img src="{% thumbnail contributor.profile.avatar 30x30 %}" class="avatar">
                                {% else %}
                                <img src="{% static 'icons/logo.png' %}" height="30" width="30" class="avatar">
                                {% endif %}
                                <span>{{contributor.get_full_name}}</span>
                            </a>
                        </li>
                    {% endfor %}
                    </ul>
                </div>
                <ul class="tag-list nostyle">
                    {% for tag in project.tags.all %}
                    <li><a class="tag" href="{% url 'tag-detail' slug=tag.slug %}">{{tag.name}}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="take-action">
        {% if request.user.is_authenticated and request.user.profile.experimental %}
        <div class="create-project">
            <h2>Start your own project</h2>
            <p>Looking to start a deep investigation into a local, state, or federal government? We can provide you with the tools and platform to fund, investigate, and broadcast your work.</p>
            <div class="call-to-action">
                <a class="primary button" href="{% url 'project-create' %}">Create a project</a>
            </div>
        </div>
        {% endif %}
        <ul>
            <li><a href="{% url 'project-list' %}">See all projects</a></li>
            <li><a href="/help/project/">Learn more about projects</a></li>
        </ul>
        <div>
            <h2>Support a project</h2>
            {% for project in crowdfunding %}
            <div class="project">
                <a href="{{project.get_absolute_url}}"><img class="image" src="{% thumbnail project.image 400x300 crop %}" /></a>
                <div class="details">
                    <h3 class="title"><a href="{{project.get_absolute_url}}">{{project.title}}</a></h3>
                    {% for crowdfund in project.active_crowdfunds %}
                    <div class="crowdfund">
                        <div class="progress"><span class="meter" style="width: {{crowdfund.percent_funded}}%"></span></div>
                        <div class="stats">
                            <p class="stat"><strong>{{crowdfund.percent_funded}}%</strong> funded</p>
                            <p class="stat"><strong>${{crowdfund.payment_received}}</strong> raised</p>
                            <p class="stat"><strong>{{crowdfund.date_due|timeuntil}}</strong> remaining</p>
                        </div>
                        <a class="success button" href="{{project.get_absolute_url}}#crowdfund-{{crowdfund.id}}">Contribute</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
