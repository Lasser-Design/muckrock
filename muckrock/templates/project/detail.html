{% extends 'base.html' %}
{% load static from staticfiles %}
{% load crowdfund_tags %}
{% load tags %}
{% load markdown_deux_tags %}
{% load thumbnail %}

{% block title %}
{{ project.title }}
{% endblock %}

{% block description %}
<meta name="description" content="{{ project.description }}" />
{% endblock %}

{% block open_graph %}
<meta property="og:type" content="article" />
<meta property="og:title" content="{{ project.title }}" />
<meta property="og:description" content="{{ project.summary }}" />
<meta property="og:url" content="{{ project.get_absolute_url }}" />
<meta property="og:site_name" content="MuckRock" />
{% if article.image %}
<meta property="og:image" content="{{ project.image }}" />
{% endif %}
{% endblock open_graph %}

{% block twitter_card %}
<meta name="twitter:site" content="@muckrock" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ project.title }}" />
<meta name="twitter:description" content="{{ project.summary }}" />
{% if project.image %}
<meta name="twitter:image:src" content="{{ project.image }}" />
{% endif %}
{% for contributor in contributors %}
{% if contributor.profile.twitter %}
<meta name="twitter:creator" content="{{ contributor.profile.twitter }}" />
{% endif %}
{% endfor %}
{% endblock twitter_card %}

{% block content %}
<div class="project detail">
    <header class="project-header">
        {% if project.image %}
        <div class="image" style="background-image:url('{% thumbnail project.image 2000x1000 crop=smart %}');"></div>
        {% endif %}
        {% if request.user.is_staff or request.user in contributors %}
        <div class="toolbar">
            {% if project.private %}
            <span class="project-private">This project is private and only visible to its contributors.</span>
            {% else %}
            <span class="project-private">This project is public.</span>
            {% endif %}
            <div class="project-controls">
                <a href="{% url 'project-crowdfund' slug=project.slug pk=project.pk %}" class="crowdfund green button">
                    Crowdfund
                </a>
                <a href="{% url 'project-update' slug=project.slug pk=project.pk %}" class="update blue button">
                    Update
                </a>
                <a href="{% url 'project-delete' slug=project.slug pk=project.pk %}" class="delete red button">
                    Delete
                </a>
            </div>
        </div>
        {% endif %}
        <div class="text">
            <h1 class="title">{{ project.title }}</h1>
        </div>
    </header>
    <section class="project-intro">
        <div class="project-summary">
            {{ project.summary|markdown:"trusted" }}
        </div>
        <aside class="project-metadata">
            <div class="project-contributors">
                <dfn>Contributors</dfn>
                {% if not contributors %}
                <p>Nobody contributes to this project.</p>
                {% else %}
                <ul class="nostyle">
                    {% for contributor in contributors %}
                    <li class="project-contributor"><a href="{{ contributor.get_absolute_url }}" title="{{ contributor}}'s profile page">{{ contributor.get_full_name }}</a></p>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% tag_manager project %}
            {% include 'lib/social.html' with title=project.title %}
        </aside>
    </section>
    {% if project.crowdfunds.exists %}
    <section class="project-crowdfunds">
        {% with project.crowdfunds.all as crowdfunds %}
        {% if crowdfunds %}
            {% for crowdfund in crowdfunds %}
                {% crowdfund crowdfund=crowdfund %}
            {% endfor %}
        {% endif %}
        {% endwith %}
    </section>
    {% endif %}

    <section class="overview" id="overview">
        <article class="project-description">
            {{ project.description|markdown:"trusted" }}
        </article>
        <aside class="project-objects">
            <div class="articles">
                <h2>{{ articles|length }} Article{{ articles|length|pluralize }}</h2>
                {% for article in project.articles.all %}
                <a class="article" href="{{article.get_absolute_url}}">
                    <img src="{% thumbnail article.image 75x75 crop %}">
                    <div class="text">
                        <div class="title">{{article.title}}</div>
                        <div class="date">{{article.pub_date|date:"m/d/y"}}</div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </aside>
    </section>

        {% if articles %}
        <section role="tabpanel" class="tab-panel articles" id="articles">
            <h2>Articles</h2>
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Pub. Date</th>
                    <tr>
                </thead>
                <tbody>
                {% for article in articles %}
                    <tr>
                        <td><a href="{{ article.get_absolute_url }}" title="{{ article.title }}">{{ article.title }}</a></td>
                        <td>{{ article.pub_date|date:"m/d/Y" }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </section>
        {% endif %}
        {% if visible_requests %}
        <section role="tabpanel" class="tab-panel requests" id="requests">
            <h2>Requests</h2>
            {% include 'lib/foia_table.html' with requests=visible_requests %}
        </section>
        {% endif %}
        {% if project.maps.exists and user_is_experimental %}
        <section role="tabpanel" class="tab-panel maps" id="requests">
            <h2>Maps</h2>
            <ul>
                {% for map in project.maps.all %}
                <li class="map"><a href="{{ map.get_absolute_url }}">{{ map.title }}</a></li>
                {% endfor %}
            </ul>
        </section>
        {% endif %}
    </div>
</div>
{% endblock %}
