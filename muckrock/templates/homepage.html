{% extends 'base.html' %}

{% load humanize %}
{% load markdown_deux_tags %}
{% load static from staticfiles %}
{% load thumbnail %}
{% load foia_tags %}
{% load news_tags %}

{% block content %}
<div class="homepage">
    <header class="mission banner">
        <h1 class="about">A <a href="//muckrock.com/about/" title="About Us">collaborative news site</a> that <a href="//muckrock.com/landing/" title="Landing Page">gives you the tools</a> to hold <a href="{{ federal_government.get_absolute_url }}" title="{{ federal_government }}">the government</a> accountable.</a></h1>
        {% comment %}
        <ul class="info channels nostyle">
            <li class="channel">
                <a href="https://www.twitter.com/muckrock">
                    {% include 'lib/icons/twitter.svg' %}
                    Follow us on Twitter
                </a>
            </li>
            <li class="channel">
                <a href="https://www.facebook.com/muckrock" target="_blank">
                    {% include 'lib/icons/facebook.svg' %}
                    Like us on Facebook
                </a>
            </li>
            <li class="channel">
                <a href="http://eepurl.com/bpgFb" target="_blank">
                    {% include 'lib/icons/email.svg' %}
                    Get our newsletter
                </a>
            </li>
        </ul>
        {% endcomment %}
    </header>
    <main>
        <section class="news">
            <h2>Recent news</h2>
            <ul class="articles nostyle">
                {% with lead_article as article %}
                <li class="lead article">
                    {% if article.image %}<a href="{{article.get_absolute_url}}" title="{{article.title}}" class="article-image"><img src="{% thumbnail article.image 1200x400 %}" /></a>{% endif %}
                    {% if article.projects.exists %}
                    {% with article.projects.first as project %}
                    <dfn class="article-project"><a href="{{project.get_absolute_url}}">{{project.title}}</a></dfn>
                    {% endwith %}
                    {% endif %}
                    <h1><a href="{{ article.get_absolute_url }}" title="{{article.title}}">{{article.title}}</a></h1>
                    <div class="article-metadata">
                        {% if article.authors.all %}
                        <div class="article-authors">by
                            {% for author in article.authors.all %}
                                <a href="{{ author.profile.get_absolute_url }}" title="{{ author.get_full_name }}">{{ author.get_full_name }}</a>{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        <datetime title="{{article.pub_date|date:'c'}}">{{article.pub_date|date:'F d, Y'}}</datetime>
                    </div>
                    {% if article.summary %}<summary>{{article.summary|markdown:"trusted"}}</summary>{% endif %}
                </li>
                {% endwith %}
                {% for article in other_articles %}
                <li class="other article">
                    {% if article.projects.exists %}
                    {% with article.projects.first as project %}
                    <dfn class="article-project"><a href="{{project.get_absolute_url}}">{{project.title}}</a></dfn>
                    {% endwith %}
                    {% endif %}
                    <h1><a href="{{ article.get_absolute_url }}" title="{{article.title}}">{{article.title}}</a></h1>
                    <div class="article-metadata">
                        {% if article.authors.all %}
                        <div class="article-authors">by
                            {% for author in article.authors.all %}
                                <a href="{{ author.profile.get_absolute_url }}" title="{{ author.get_full_name }}">{{ author.get_full_name }}</a>{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}
                        <datetime title="{{article.pub_date|date:'c'}}">{{article.pub_date|date:'F d, Y'}}</datetime>
                    </div>
                    {% if article.summary %}<summary>{{article.summary|markdown:"trusted"}}</summary>{% endif %}
                </li>
                {% endfor %}
            </ul>
        </section>
        {% if featured_projects %}
        <section class="projects">
            <h2>Featured projects</h2>
            <ul class="project-list nostyle">
            {% for project in featured_projects %}
                <li class="project-item" {% if project.image %}style="background-image:url('{% thumbnail project.image 800x600 %}')"{% endif %}>
                    <a href="{{project.get_absolute_url}}" title="{{project.title}}">
                        <div class="project-info">
                            <h4 class="title">{{project.title}}</h4>
                            <p class="summary">{{project.summary|truncatechars:"300"}}</p>
                        </div>
                    </a>
                </li>
            {% endfor %}
            </ul>
        </section>
        {% endif %}
        <section class="requests">
            <h2>Recently completed requests</h2>
            {% for foia in completed_requests %}
                {% include 'lib/foia.html' with hide_actions=True %}
            {% endfor %}
            <a href="{% url 'foia-list' %}?status=completed">See more</a>
        </section>
    </main>
    <footer class="foia banner" style="background-image: url('{% static 'img/homepage/requests.jpg' %}');">
        <div class="about">
            <h2>File, track, and share<br />public records requests</h2>
            <div class="call-to-action"><a href="{% url 'foia-create' %}" class="primary button">Create a FOIA request</a>&emsp;or <a href="/about/how-we-work/" class="dotted" id="learn-more">learn how it works</a>.</div>
        </div>
        <div class="info">
            <ul class="stats">
                <li class="stat">
                    <div class="value">{{ stats.request_count|intcomma }}</div>
                    <div class="key">filed request{{ stats.request_count|pluralize }}</div>
                </li>
                <li class="stat">
                    <div class="value">{{ stats.agency_count|intcomma }}</div>
                    <div class="key">agenc{{ stats.agency_count|pluralize:"y,ies" }}</div>
                </li>
                <li class="stat">
                    <div class="value">{{ stats.completed_count|intcomma }}</div>
                    <div class="key">fulfilled request{{ stats.completed_count|pluralize }}</div>
                </li>
                <li class="stat">
                    <div class="value">{{ stats.page_count|intcomma }}</div>
                    <div class="key">released page{{ stats.page_count|pluralize }}</div>
                </li>
            </ul>
        </div>
    </footer>
</div>
{% endblock content %}
